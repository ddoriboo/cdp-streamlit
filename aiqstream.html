<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDP AI 자연어 쿼리 플랫폼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .api-key-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            margin: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .api-key-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }
        
        .api-key-header:hover {
            background: rgba(255, 193, 7, 0.1);
        }
        
        .api-key-header h4 {
            margin: 0;
        }
        
        .toggle-icon {
            font-size: 14px;
            transition: transform 0.3s ease;
            color: #856404;
        }
        
        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .api-key-content {
            padding: 0 20px 20px 20px;
            max-height: 300px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .api-key-content.collapsed {
            max-height: 0;
            padding: 0 20px;
        }
        
        .api-key-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        
        .api-key-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .api-key-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .api-key-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .api-key-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-key-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* 탭 스타일 */
        .tab-container {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab-nav {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            background: #e9ecef;
        }
        
        .tab-button.active {
            background: white;
            border-bottom-color: #4CAF50;
            color: #4CAF50;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 쿼리 분석기 스타일 (기존) */
        .query-input-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .query-input {
            width: 100%;
            padding: 20px 60px 20px 20px;
            font-size: 18px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .query-input:focus {
            border-color: #4CAF50;
        }
        
        .query-input::placeholder {
            color: #6c757d;
        }
        
        .query-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .query-button:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .query-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(-50%);
        }
        
        .query-examples {
            margin-top: 20px;
            text-align: center;
        }
        
        .example-tag {
            display: inline-block;
            background: white;
            color: #495057;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .example-tag:hover {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
        }
        
        /* 컬럼 브라우저 스타일 */
        .column-browser {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .search-box {
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #4CAF50;
        }
        
        .category-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .column-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .column-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .column-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }
        
        .column-card-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .column-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .column-category {
            background: #e9ecef;
            color: #6c757d;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 10px;
            margin-left: auto;
        }
        
        .column-description {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .column-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #8e8e8e;
        }
        
        .column-type {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 팀별 추천 스타일 */
        .team-recommendations {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* 팀 버튼 스타일 */
        .team-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .team-button {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .team-button:hover {
            border-color: #4CAF50;
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .team-button .name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .team-button .role {
            font-size: 14px;
            color: #6c757d;
        }
        
        /* 추천 질문 스타일 */
        .recommended-questions {
            display: none;
            margin-top: 30px;
        }
        
        .recommended-questions.active {
            display: block;
        }
        
        .recommended-questions h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .question-list {
            display: grid;
            gap: 15px;
        }
        
        .question-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #4CAF50;
        }
        
        .question-card:hover {
            background: #f8f9fa;
            border-color: #4CAF50;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .question-text {
            font-size: 16px;
            color: #2c3e50;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .question-desc {
            font-size: 14px;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .question-tags {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .question-tag {
            background: #e9ecef;
            color: #495057;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 10px;
        }
        
        .team-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .team-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .team-card.marketing {
            border-left: 5px solid #e74c3c;
        }
        
        .team-card.sales {
            border-left: 5px solid #3498db;
        }
        
        .team-card.product {
            border-left: 5px solid #f39c12;
        }
        
        .team-card.finance {
            border-left: 5px solid #9b59b6;
        }
        
        .team-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .team-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .team-icon.marketing {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .team-icon.sales {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .team-icon.product {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .team-icon.finance {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .team-name {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .team-scenarios {
            display: none;
            margin-top: 30px;
        }
        
        .team-scenarios.active {
            display: block;
        }
        
        .scenario-list {
            display: grid;
            gap: 15px;
        }
        
        .scenario-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .scenario-card:hover {
            background: white;
            border-color: #4CAF50;
            transform: translateX(5px);
        }
        
        .scenario-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scenario-description {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .scenario-metrics {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }
        
        .scenario-metric {
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            border: 1px solid #dee2e6;
        }
        
        /* 공통 스타일 */
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }
        
        .analysis-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .analysis-title::before {
            content: "🎯";
            margin-right: 10px;
        }
        
        .column-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .column-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .column-group h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .column-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-score {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .reasoning-section {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .reasoning-section h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .reasoning-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }
        
        .sql-section {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .sql-section h4 {
            margin-bottom: 15px;
            color: #ecf0f1;
        }
        
        .sql-query {
            background: #34495e;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .copy-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .export-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }
        
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .tab-nav {
                flex-direction: column;
            }
            
            .column-cards {
                grid-template-columns: 1fr;
            }
            
            .team-cards {
                grid-template-columns: 1fr;
            }
            
            .column-recommendations {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            .query-input {
                font-size: 16px;
                padding: 15px 50px 15px 15px;
            }
            
            .api-key-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 CDP x LLM Test</h1>
            <p>AI 기반 고객 세그먼테이션 · 컬럼 탐색 · 팀별 맞춤 추천</p>
        </div>
        
        <div class="api-key-section">
            <div class="api-key-header" onclick="toggleApiKeySection()">
                <h4>🔑 API 키 설정</h4>
                <span class="toggle-icon collapsed" id="toggleIcon">▼</span>
            </div>
            <div class="api-key-content collapsed" id="apiKeyContent">
                <p>실제 AI 분석을 위해 API 키를 입력해주세요. (<a href="https://platform.openai.com/api-keys" target="_blank">API 키 발급받기</a>)</p>
                <div class="api-key-container">
                    <input type="password" 
                           class="api-key-input" 
                           id="apiKeyInput" 
                           placeholder="sk-proj-으로 시작하는 OpenAI API 키를 입력하세요">
                    <button class="api-key-button" onclick="saveApiKey()">저장</button>
                </div>
                <div class="api-key-status" id="apiKeyStatus"></div>
            </div>
        </div>
        
        <!-- 탭 네비게이션 -->
        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('analyzer')">
                    🔍 쿼리 분석기
                </button>
                <button class="tab-button" onclick="switchTab('browser')">
                    📊 컬럼 브라우저
                </button>
                <button class="tab-button" onclick="switchTab('teams')">
                    👥 팀별 추천
                </button>
            </div>
        </div>
        
        <!-- 쿼리 분석기 탭 -->
        <div class="tab-content active" id="analyzer-tab">
            <div id="querySection">
                <div class="query-input-container">
                    <input type="text" 
                           class="query-input" 
                           id="queryInput" 
                           placeholder="예: 대출 니즈가 높은 고객군 알려줘, 젊은 여성 중 뷰티 관심사가 높은 고객 찾아줘"
                           onkeypress="handleKeyPress(event)">
                    <button class="query-button" id="queryButton" onclick="processQuery()">
                        🔍 분석
                    </button>
                </div>
                
                <div class="query-examples">
                    <div class="example-tag" onclick="setExampleQuery('대출 니즈가 높은 고객군 알려줘')">
                        💰 대출 니즈 고객
                    </div>
                    <div class="example-tag" onclick="setExampleQuery('20-30대 여성 중 뷰티에 관심이 많은 고객')">
                        💄 뷰티 관심 여성
                    </div>
                    <div class="example-tag" onclick="setExampleQuery('고소득층 중 투자 상품에 관심있는 고객')">
                        📈 투자 관심 고객
                    </div>
                    <div class="example-tag" onclick="setExampleQuery('해외여행을 자주 가는 고객 중 보험 가입 가능성이 높은 사람')">
                        ✈️ 여행자보험 대상
                    </div>
                    <div class="example-tag" onclick="setExampleQuery('1인 가구 중 배달음식을 자주 시키는 고객')">
                        🏠 1인가구 배달족
                    </div>
                    <div class="example-tag" onclick="setExampleQuery('골프를 치는 고객 중 프리미엄 서비스 이용 가능성이 높은 사람')">
                        ⛳ 골프 VIP 고객
                    </div>
                </div>
            </div>
            
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p>🤖 실제 AI가 CDP 데이터를 분석하여 최적의 고객 세그먼테이션 전략을 생성하고 있습니다...</p>
            </div>
            
            <div class="results-container" id="resultsContainer">
                <div id="analysisResults"></div>
            </div>
        </div>
        
        <!-- 컬럼 브라우저 탭 -->
        <div class="tab-content" id="browser-tab">
            <div class="column-browser">
                <h2>📊 CDP 컬럼 브라우저</h2>
                <p style="margin-bottom: 30px; color: #6c757d;">CDP 데이터베이스의 모든 컬럼을 탐색하고 활용법을 확인하세요.</p>
                
                <div class="search-box">
                    <input type="text" 
                           class="search-input" 
                           id="columnSearch" 
                           placeholder="컬럼명이나 설명으로 검색..."
                           oninput="filterColumns()">
                </div>
                
                <div class="category-filter">
                    <button class="filter-btn active" onclick="filterByCategory('all')">전체</button>
                    <button class="filter-btn" onclick="filterByCategory('interests')">관심사 지표</button>
                    <button class="filter-btn" onclick="filterByCategory('industries')">업종별 지표</button>
                    <button class="filter-btn" onclick="filterByCategory('scores')">예측 스코어</button>
                    <button class="filter-btn" onclick="filterByCategory('flags')">플래그 지표</button>
                </div>
                
                <div class="column-cards" id="columnCards">
                    <!-- 컬럼 카드들이 동적으로 생성됩니다 -->
                </div>
            </div>
        </div>
        
        <!-- 팀별 추천 탭 -->
        <div class="tab-content" id="teams-tab">
            <div class="team-recommendations">
                <h2>👥 팀별 맞춤 추천 질문</h2>
                <p style="margin-bottom: 20px; color: #6c757d;">각 담당자님의 업무 영역에 특화된 질문들을 추천드립니다.</p>
                
                <div class="team-buttons">
                    <button class="team-button" onclick="showTeamQuestions('financial-content')">
                        <div class="name">💰 정선영님</div>
                        <div class="role">금융 컨텐츠 (머니스토리)</div>
                    </button>
                    <button class="team-button" onclick="showTeamQuestions('member-planning')">
                        <div class="name">👥 박지영님</div>
                        <div class="role">회원 플래닝</div>
                    </button>
                    <button class="team-button" onclick="showTeamQuestions('myasset')">
                        <div class="name">🏦 김정희님</div>
                        <div class="role">내자산 플래닝 (마이데이터)</div>
                    </button>
                    <button class="team-button" onclick="showTeamQuestions('advertising')">
                        <div class="name">📢 고시현님</div>
                        <div class="role">AD 서비스</div>
                    </button>
                    <button class="team-button" onclick="showTeamQuestions('payment')">
                        <div class="name">💳 최동주님</div>
                        <div class="role">결제 데이터</div>
                    </button>
                    <button class="team-button" onclick="showTeamQuestions('loan')">
                        <div class="name">🏠 이승한님</div>
                        <div class="role">대출 서비스</div>
                    </button>
                </div>
                
                <div class="recommended-questions" id="teamQuestions">
                    <!-- 추천 질문들이 여기에 동적으로 생성됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // CDP 컬럼 정의
        const CDP_COLUMNS = {
            interests: {
                'fa_int_householdsingle': '1인 가구 관련 상품 결제',
                'fa_int_householdpet': '반려동물 관련 상품 결제',
                'fa_int_householdchild': '어린이 관련 상품 결제',
                'fa_int_householdbaby': '영유아 관련 상품 결제',
                'fa_int_loan1stfinancial': '1금융권 신용대출 실행',
                'fa_int_loan2ndfinancial': '2금융권 신용대출 실행',
                'fa_int_loanpersonal': '신용대출 실행',
                'fa_int_saving': '예적금 개설',
                'fa_int_homeappliance': '가전 상품 결제',
                'fa_int_luxury': '명품 관련 결제',
                'fa_int_delivery': '배달 결제',
                'fa_int_carinsurance': '자동차 보험 결제 예정',
                'fa_int_carpurchase': '차량 구매',
                'fa_int_traveloverseas': '해외여행 예정',
                'fa_int_traveldomestic': '국내여행',
                'fa_int_golf': '골프 관련 결제',
                'fa_int_gym': '피트니스/헬스장 결제',
                'fa_int_wedding': '결혼 준비 관련',
                'fa_int_highincome': '추정소득 1억 이상',
                'fa_int_homeowner': '주택 소유',
                'fa_int_business': '사업자',
                'fa_int_worker': '정기 급여 수령'
            },
            industries: {
                'fa_ind_finance': '금융 결제',
                'fa_ind_insurance': '보험 결제',
                'fa_ind_beauty': '미용 결제',
                'fa_ind_medical': '의료 결제',
                'fa_ind_travel': '여행 결제',
                'fa_ind_foodbeverage': 'F&B 결제',
                'fa_ind_cafe': '카페 결제',
                'fa_ind_restaurant': '음식점 결제',
                'fa_ind_delivery': '배달 결제',
                'fa_ind_cosmetic': '뷰티 결제',
                'fa_ind_fashion': '패션의류 결제',
                'fa_ind_digitalappliances': '디지털가전 결제',
                'fa_ind_education': '교육 결제',
                'fa_ind_golfcourse': '골프장 결제',
                'fa_ind_fitness': '피트니스 결제'
            },
            scores: {
                'sc_int_loan1stfinancial': '1금융권 대출 예측스코어',
                'sc_int_loan2ndfinancial': '2금융권 대출 예측스코어',
                'sc_int_luxury': '명품 구매 예측스코어',
                'sc_int_delivery': '배달 이용 예측스코어',
                'sc_int_golf': '골프 관련 예측스코어',
                'sc_int_highincome': '고소득 예측스코어',
                'sc_int_wedding': '결혼 준비 예측스코어',
                'sc_ind_beauty': '미용 서비스 예측스코어',
                'sc_ind_cosmetic': '뷰티 제품 예측스코어',
                'sc_ind_finance': '금융 서비스 예측스코어'
            },
            flags: {
                'fi_npay_age20': '20대',
                'fi_npay_age30': '30대',
                'fi_npay_age40': '40대',
                'fi_npay_genderf': '여성',
                'fi_npay_genderm': '남성',
                'fi_npay_membershipnormal': '플러스멤버십 가입',
                'fi_npay_myassetreg': '내자산 서비스 연동',
                'fi_npay_creditcheck': '신용조회 서비스 가입'
            }
        };

        // 팀별 추천 질문 정의
        const TEAM_QUESTIONS = {
            'financial-content': {
                name: '정선영님',
                role: '금융 컨텐츠 (머니스토리)',
                icon: '💰',
                questions: [
                    {
                        text: '고소득층 중 투자 관심도가 높은 고객 찾아줘',
                        description: '머니스토리 투자 콘텐츠에 관심을 가질 가능성이 높은 고객군 분석',
                        tags: ['투자', '고소득', '머니스토리']
                    },
                    {
                        text: '20-30대 여성 중 가계부 관리에 관심이 많은 고객',
                        description: '가계부 작성 및 가계 관리 콘텐츠 타겟 고객 발굴',
                        tags: ['가계부', '20-30대', '여성']
                    },
                    {
                        text: '대출 경험이 있으면서 금융 정보에 관심이 높은 고객',
                        description: '대출 관련 금융 교육 콘텐츠 수요층 분석',
                        tags: ['대출', '금융교육', '콘텐츠']
                    },
                    {
                        text: '적금/예금 개설 경험이 있는 고객 중 재테크 관심군',
                        description: '저축 상품 비교 및 재테크 콘텐츠 타겟 고객',
                        tags: ['적금', '예금', '재테크']
                    }
                ]
            },
            'member-planning': {
                name: '박지영님',
                role: '회원 플래닝',
                icon: '👥',
                questions: [
                    {
                        text: '플러스 멤버십 가입 가능성이 높은 고객',
                        description: '멤버십 혜택 활용도가 높을 것으로 예상되는 고객군 분석',
                        tags: ['멤버십', '가입전환', '혜택']
                    },
                    {
                        text: '최근 3개월 간 활동이 감소한 기존 회원',
                        description: '회원 이탈 방지 및 재활성화 대상 고객 식별',
                        tags: ['회원이탈', '재활성화', '리텐션']
                    },
                    {
                        text: '네이버페이 사용 빈도가 높은 고객',
                        description: '페이 서비스 충성도가 높은 핵심 고객층 분석',
                        tags: ['네이버페이', '충성도', '활성사용자']
                    },
                    {
                        text: '다양한 카테고리에서 결제하는 고객',
                        description: '종합적인 서비스 이용 패턴을 보이는 고객 특성 분석',
                        tags: ['다양성', '결제패턴', '종합이용']
                    }
                ]
            },
            'myasset': {
                name: '김정희님',
                role: '내자산 플래닝 (마이데이터)',
                icon: '🏦',
                questions: [
                    {
                        text: '내자산 서비스 연동 가능성이 높은 고객',
                        description: '마이데이터 서비스 이용 의향이 높은 고객군 발굴',
                        tags: ['마이데이터', '내자산', '연동']
                    },
                    {
                        text: '다수의 금융기관 이용 고객',
                        description: '자산 통합 관리 니즈가 있는 고객 식별',
                        tags: ['통합관리', '다수계좌', '자산관리']
                    },
                    {
                        text: '신용조회 서비스 가입 고객의 자산 관리 패턴',
                        description: '신용관리에 관심이 높은 고객의 자산 관리 행태 분석',
                        tags: ['신용조회', '자산관리', '금융관리']
                    },
                    {
                        text: '정기적인 투자 활동을 하는 고객',
                        description: '포트폴리오 관리 서비스 수요가 높은 고객군',
                        tags: ['투자', '포트폴리오', '정기투자']
                    }
                ]
            },
            'advertising': {
                name: '고시현님',
                role: 'AD 서비스',
                icon: '📢',
                questions: [
                    {
                        text: '온라인 쇼핑 빈도가 높은 고객',
                        description: '광고 노출 효과가 높을 것으로 예상되는 활성 쇼핑 고객',
                        tags: ['온라인쇼핑', '광고효과', '활성고객']
                    },
                    {
                        text: '20-30대 중 뷰티/패션 관심사가 높은 고객',
                        description: '뷰티/패션 광고 타겟팅에 적합한 고객군 분석',
                        tags: ['뷰티', '패션', '20-30대']
                    },
                    {
                        text: '브랜드 충성도가 높은 고객',
                        description: '특정 브랜드에 대한 재구매율이 높은 고객 특성',
                        tags: ['브랜드', '충성도', '재구매']
                    },
                    {
                        text: '계절별 소비 패턴이 뚜렷한 고객',
                        description: '시즌별 광고 캠페인 최적화를 위한 고객 분석',
                        tags: ['계절성', '소비패턴', '캠페인']
                    }
                ]
            },
            'payment': {
                name: '최동주님',
                role: '결제 데이터',
                icon: '💳',
                questions: [
                    {
                        text: '결제 수단 다양성이 높은 고객',
                        description: '여러 결제 수단을 활용하는 고객의 결제 패턴 분석',
                        tags: ['결제수단', '다양성', '결제패턴']
                    },
                    {
                        text: '고액 결제를 자주 하는 고객',
                        description: '프리미엄 결제 서비스 수요가 높은 고객군',
                        tags: ['고액결제', '프리미엄', 'VIP']
                    },
                    {
                        text: '해외 결제 경험이 있는 고객',
                        description: '해외 결제 서비스 개선 및 확대를 위한 고객 분석',
                        tags: ['해외결제', '글로벌', '여행']
                    },
                    {
                        text: '정기 결제 서비스 이용 고객',
                        description: '구독 서비스 및 정기 결제 활용도가 높은 고객',
                        tags: ['정기결제', '구독', '자동결제']
                    }
                ]
            },
            'loan': {
                name: '이승한님',
                role: '대출 서비스',
                icon: '🏠',
                questions: [
                    {
                        text: '대출 니즈가 높은 고객군',
                        description: '신용대출 상품 제안에 적합한 고객 발굴',
                        tags: ['대출', '신용대출', '금융상품']
                    },
                    {
                        text: '주택 구매 관련 활동이 있는 고객',
                        description: '주택담보대출 수요가 있는 고객 식별',
                        tags: ['주택', '부동산', '담보대출']
                    },
                    {
                        text: '기존 대출 고객 중 추가 대출 가능성이 높은 고객',
                        description: '대환대출 또는 한도 증액 대상 고객 분석',
                        tags: ['기존고객', '대환대출', '한도증액']
                    },
                    {
                        text: '신용등급이 양호하면서 소득이 안정적인 고객',
                        description: '우대 금리 대출 상품 타겟 고객 발굴',
                        tags: ['신용등급', '소득안정', '우대금리']
                    }
                ]
            }
        };

        let OPENAI_API_KEY = '';
        let currentFilter = 'all';

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            const savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                OPENAI_API_KEY = savedApiKey;
                document.getElementById('apiKeyInput').value = savedApiKey;
                updateApiKeyStatus(true, '✅ API 키가 설정되었습니다.');
                enableQuerySection();
                // API 키가 설정되어 있으면 드롭다운 열기
                const content = document.getElementById('apiKeyContent');
                const icon = document.getElementById('toggleIcon');
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
            } else {
                disableQuerySection();
            }
            
            // 컬럼 브라우저 초기화
            generateColumnCards();
        });

        // 탭 전환
        function switchTab(tabName) {
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 선택된 탭 활성화
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // 컬럼 카드 생성
        function generateColumnCards() {
            const container = document.getElementById('columnCards');
            container.innerHTML = '';
            
            Object.entries(CDP_COLUMNS).forEach(([category, columns]) => {
                Object.entries(columns).forEach(([columnName, description]) => {
                    const card = createColumnCard(columnName, description, category);
                    container.appendChild(card);
                });
            });
        }

        function createColumnCard(columnName, description, category) {
            const card = document.createElement('div');
            card.className = 'column-card';
            card.setAttribute('data-category', category);
            card.setAttribute('data-name', columnName.toLowerCase());
            card.setAttribute('data-description', description.toLowerCase());
            
            const typeInfo = getColumnTypeInfo(columnName);
            
            card.innerHTML = `
                <div class="column-card-header">
                    <div>
                        <div class="column-name">${columnName}</div>
                    </div>
                    <div class="column-category">${getCategoryLabel(category)}</div>
                </div>
                <div class="column-description">${description}</div>
                <div class="column-meta">
                    <div class="column-type">
                        <span>${typeInfo.icon}</span>
                        <span>${typeInfo.type}</span>
                    </div>
                    <div>활용도: ${getUsageLevel()}</div>
                </div>
            `;
            
            card.onclick = () => useColumnInQuery(columnName);
            
            return card;
        }

        function getCategoryLabel(category) {
            const labels = {
                interests: '관심사',
                industries: '업종별',
                scores: '예측점수',
                flags: '플래그'
            };
            return labels[category] || category;
        }

        function getColumnTypeInfo(columnName) {
            if (columnName.startsWith('sc_')) {
                return { icon: '📊', type: 'Double (0-1)' };
            } else if (columnName.startsWith('fi_')) {
                return { icon: '🏷️', type: 'Boolean' };
            } else {
                return { icon: '📅', type: 'Date' };
            }
        }

        function getUsageLevel() {
            const levels = ['높음', '보통', '낮음'];
            return levels[Math.floor(Math.random() * 3)];
        }

        // 컬럼 필터링
        function filterByCategory(category) {
            currentFilter = category;
            
            // 필터 버튼 업데이트
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 카드 필터링
            const cards = document.querySelectorAll('.column-card');
            cards.forEach(card => {
                if (category === 'all' || card.getAttribute('data-category') === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterColumns() {
            const searchTerm = document.getElementById('columnSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.column-card');
            
            cards.forEach(card => {
                const name = card.getAttribute('data-name');
                const description = card.getAttribute('data-description');
                const category = card.getAttribute('data-category');
                
                const matchesSearch = name.includes(searchTerm) || description.includes(searchTerm);
                const matchesCategory = currentFilter === 'all' || category === currentFilter;
                
                if (matchesSearch && matchesCategory) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function useColumnInQuery(columnName) {
            switchTab('analyzer');
            document.getElementById('queryInput').value = `${columnName} 컬럼을 활용한 고객 세그먼테이션 분석해줘`;
            document.getElementById('queryInput').focus();
        }

        // 팀별 시나리오 표시
        function showTeamScenarios(teamName) {
            // 모든 시나리오 숨기기
            document.querySelectorAll('.team-scenarios').forEach(scenario => {
                scenario.classList.remove('active');
            });
            
            // 선택된 팀 시나리오 표시
            document.getElementById(teamName + 'Scenarios').classList.add('active');
        }

        function useTeamScenario(query) {
            switchTab('analyzer');
            document.getElementById('queryInput').value = query;
            processQuery();
        }

        // 팀별 추천 질문 표시
        function showTeamQuestions(teamId) {
            const teamData = TEAM_QUESTIONS[teamId];
            if (!teamData) return;
            
            const questionsContainer = document.getElementById('teamQuestions');
            
            // 추천 질문 섹션 생성
            questionsContainer.innerHTML = `
                <h3>${teamData.icon} ${teamData.name} - ${teamData.role}</h3>
                <div class="question-list">
                    ${teamData.questions.map(question => `
                        <div class="question-card" onclick="useTeamQuestion('${question.text}')">
                            <div class="question-text">${question.text}</div>
                            <div class="question-desc">${question.description}</div>
                            <div class="question-tags">
                                ${question.tags.map(tag => `<span class="question-tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // 추천 질문 영역 표시
            questionsContainer.classList.add('active');
        }

        // 추천 질문 사용
        function useTeamQuestion(question) {
            switchTab('analyzer');
            document.getElementById('queryInput').value = question;
            document.getElementById('queryInput').focus();
        }

        // API 키 섹션 토글
        function toggleApiKeySection() {
            const content = document.getElementById('apiKeyContent');
            const icon = document.getElementById('toggleIcon');
            
            content.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        // 기존 쿼리 분석기 함수들
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                updateApiKeyStatus(false, '❌ API 키를 입력해주세요.');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                updateApiKeyStatus(false, '❌ 올바른 OpenAI API 키 형식이 아닙니다. (sk-로 시작해야 함)');
                return;
            }

            testApiKey(apiKey).then(isValid => {
                if (isValid) {
                    OPENAI_API_KEY = apiKey;
                    localStorage.setItem('openai_api_key', apiKey);
                    updateApiKeyStatus(true, '✅ API 키가 성공적으로 저장되었습니다!');
                    enableQuerySection();
                    // API 키 저장 성공 시 3초 후 드롭다운 닫기
                    setTimeout(() => {
                        const content = document.getElementById('apiKeyContent');
                        const icon = document.getElementById('toggleIcon');
                        content.classList.add('collapsed');
                        icon.classList.add('collapsed');
                    }, 3000);
                } else {
                    updateApiKeyStatus(false, '❌ 유효하지 않은 API 키입니다. 다시 확인해주세요.');
                    disableQuerySection();
                }
            }).catch(error => {
                updateApiKeyStatus(false, '❌ API 키 검증 중 오류가 발생했습니다: ' + error.message);
                disableQuerySection();
            });
        }

        async function testApiKey(apiKey) {
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                return response.ok;
            } catch (error) {
                console.error('API 키 테스트 실패:', error);
                return false;
            }
        }

        function updateApiKeyStatus(success, message) {
            const statusDiv = document.getElementById('apiKeyStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'api-key-status ' + (success ? 'success' : 'error');
            statusDiv.textContent = message;
        }

        function enableQuerySection() {
            document.getElementById('querySection').classList.remove('disabled');
            document.getElementById('queryInput').disabled = false;
            document.getElementById('queryButton').disabled = false;
        }

        function disableQuerySection() {
            document.getElementById('querySection').classList.add('disabled');
            document.getElementById('queryInput').disabled = true;
            document.getElementById('queryButton').disabled = true;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                processQuery();
            }
        }
        
        function setExampleQuery(query) {
            document.getElementById('queryInput').value = query;
            document.getElementById('queryInput').focus();
        }
        
        async function processQuery() {
            if (!OPENAI_API_KEY) {
                alert('먼저 OpenAI API 키를 설정해주세요.');
                return;
            }

            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('질문을 입력해주세요.');
                return;
            }
            
            const button = document.getElementById('queryButton');
            button.disabled = true;
            button.textContent = '분석 중...';
            
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            try {
                const result = await analyzeQueryWithAI(query);
                displayResults(result);
            } catch (error) {
                console.error('Error:', error);
                displayError('AI 분석 중 오류가 발생했습니다: ' + error.message);
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
                button.disabled = false;
                button.textContent = '🔍 분석';
            }
        }
        
        async function analyzeQueryWithAI(userQuery) {
            const prompt = createAnalysisPrompt(userQuery);
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-2024-11-20',
                    messages: [
                        {
                            role: 'system',
                            content: `당신은 CDP(Customer Data Platform) 전문가입니다. 사용자의 자연어 질문을 분석하여 최적의 고객 세그먼테이션 전략을 제공합니다.

다음 CDP 컬럼들을 활용하여 분석해주세요:
${JSON.stringify(CDP_COLUMNS, null, 2)}

응답은 반드시 다음 JSON 형식으로만 제공해주세요. 다른 텍스트는 포함하지 마세요:
{
    "query_analysis": "사용자 질문 분석 내용",
    "target_description": "타겟 고객군 설명",
    "recommended_columns": [
        {
            "column": "컬럼명",
            "description": "컬럼 설명",
            "condition": "추천 조건 (예: > 0.7, IS NOT NULL 등)",
            "priority": "high|medium|low",
            "reasoning": "선택 이유"
        }
    ],
    "sql_query": "SELECT 문으로 된 쿼리",
    "business_insights": [
        "비즈니스 인사이트 1",
        "비즈니스 인사이트 2"
    ],
    "estimated_target_size": "예상 타겟 규모 (%)",
    "marketing_recommendations": [
        "마케팅 추천사항 1",
        "마케팅 추천사항 2"
    ]
}`
                        },
                        {
                            role: 'user',
                            content: userQuery
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 2000
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`OpenAI API Error (${response.status}): ${errorData.error.message}`);
            }
            
            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            
            try {
                return JSON.parse(aiResponse);
            } catch (parseError) {
                console.error('JSON 파싱 실패:', parseError);
                console.log('AI 응답:', aiResponse);
                throw new Error('AI 응답을 처리할 수 없습니다. JSON 형식이 올바르지 않습니다.');
            }
        }
        
        function createAnalysisPrompt(query) {
            return `사용자 질문: "${query}"

위 질문을 분석하여 다음을 제공해주세요:

1. 질문의 핵심 요구사항 분석
2. 타겟 고객군을 정의하기 위한 최적의 CDP 컬럼 조합 추천
3. 각 컬럼을 선택한 이유와 추천 조건값
4. 실행 가능한 SQL 쿼리
5. 비즈니스 인사이트 및 마케팅 활용 방안

CDP 데이터의 특성:
- fa_int_*: 관심사 기반 행동 지표 (date 타입, 이벤트 발생일)
- fa_ind_*: 업종별 결제 지표 (date 타입, 결제일)
- sc_*: AI 예측 스코어 (0-1 범위의 double 타입)
- fi_npay_*: 플래그 지표 (boolean 타입)

반드시 JSON 형식으로만 응답해주세요.`;
        }
        
        function displayResults(result) {
            const resultsDiv = document.getElementById('analysisResults');
            
            resultsDiv.innerHTML = `
                <div class="analysis-result">
                    <div class="analysis-title">🤖 AI 질문 분석 결과</div>
                    <p>${result.query_analysis}</p>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">🎯 타겟 고객군 정의</div>
                    <p>${result.target_description}</p>
                </div>
                
                <div class="stats-section">
                    <div class="stat-card">
                        <div class="stat-number">${result.recommended_columns.length}</div>
                        <div class="stat-label">AI 추천 컬럼 수</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.estimated_target_size}</div>
                        <div class="stat-label">예상 타겟 규모</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${result.marketing_recommendations.length}</div>
                        <div class="stat-label">AI 마케팅 제안</div>
                    </div>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">🧠 AI 추천 CDP 컬럼 조합</div>
                    <div class="column-recommendations">
                        ${generateColumnRecommendations(result.recommended_columns)}
                    </div>
                </div>
                
                <div class="reasoning-section">
                    <h4>🔍 AI 분석 근거</h4>
                    ${result.recommended_columns.map(col => `
                        <div class="reasoning-item">
                            <strong>${col.column}:</strong> ${col.reasoning}
                        </div>
                    `).join('')}
                </div>
                
                <div class="sql-section">
                    <h4>📝 AI 생성 SQL 쿼리</h4>
                    <div class="sql-query">${result.sql_query}</div>
                    <button class="copy-button" onclick="copyToClipboard(\`${result.sql_query.replace(/`/g, '\\`')}\`)">
                        📋 쿼리 복사
                    </button>
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">💡 AI 비즈니스 인사이트</div>
                    ${result.business_insights.map(insight => `<p>• ${insight}</p>`).join('')}
                </div>
                
                <div class="analysis-result">
                    <div class="analysis-title">🚀 AI 마케팅 활용 방안</div>
                    ${result.marketing_recommendations.map(rec => `<p>• ${rec}</p>`).join('')}
                </div>
                
                <div class="export-section">
                    <h4>📊 결과 활용</h4>
                    <button class="export-button" onclick="copyToClipboard(\`${result.sql_query.replace(/`/g, '\\`')}\`)">
                        SQL 복사
                    </button>
                    <button class="export-button" onclick="copyAnalysisResults()">
                        전체 결과 복사
                    </button>
                    <button class="export-button" onclick="shareResults()">
                        결과 공유
                    </button>
                </div>
            `;
        }
        
        function generateColumnRecommendations(columns) {
            const grouped = {
                high: columns.filter(c => c.priority === 'high'),
                medium: columns.filter(c => c.priority === 'medium'),
                low: columns.filter(c => c.priority === 'low')
            };
            
            return Object.entries(grouped).map(([priority, cols]) => {
                if (cols.length === 0) return '';
                
                const priorityLabels = {
                    high: '🔥 핵심 지표',
                    medium: '⭐ 보조 지표',
                    low: '💡 참고 지표'
                };
                
                return `
                    <div class="column-group">
                        <h4>${priorityLabels[priority]}</h4>
                        ${cols.map(col => `
                            <div class="column-item">
                                <div>
                                    <div class="column-name">${col.column}</div>
                                    <div style="font-size: 0.9em; color: #6c757d; margin-top: 2px;">
                                        ${col.description}
                                    </div>
                                    <div style="font-size: 0.8em; color: #4CAF50; margin-top: 2px;">
                                        조건: ${col.condition}
                                    </div>
                                </div>
                                <div class="column-score">${priority.toUpperCase()}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }
        
        function displayError(message) {
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.innerHTML = `
                <div class="error-message">
                    <h4>⚠️ 오류 발생</h4>
                    <p>${message}</p>
                    <p>다시 시도하시거나 API 키를 확인해주세요.</p>
                </div>
            `;
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('클립보드에 복사되었습니다!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('클립보드에 복사되었습니다!');
            });
        }
        
        function copyAnalysisResults() {
            const results = document.getElementById('analysisResults');
            const text = results.innerText;
            copyToClipboard(text);
        }
        
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'CDP AI 분석 결과',
                    text: '실제 AI가 분석한 고객 세그먼테이션 결과를 확인해보세요.',
                    url: window.location.href
                });
            } else {
                copyToClipboard(window.location.href);
                alert('페이지 URL이 클립보드에 복사되었습니다!');
            }
        }
    </script>
</body>
</html>